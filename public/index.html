<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sadece Biz D√ºnyasƒ±</title>
<style>
  :root{
    --mor:#6d28d9; --mor2:#7c3aed; --pembe:#ec4899; --zemin:#faf5ff;
  }
  *{box-sizing:border-box} body{
    margin:0; font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    background:linear-gradient(135deg,#fde2e7,#ffd6e7 40%, #ffd6f5 70%, #ffe7ff);
    min-height:100vh; color:#2d2a32;
  }
  header{background:linear-gradient(90deg,var(--mor),var(--mor2));
    color:#fff; padding:14px 18px; text-align:center; font-weight:700; letter-spacing:.3px;
    box-shadow:0 8px 28px rgba(109,40,217,.35);
    position:sticky; top:0; z-index:10; border-bottom-left-radius:14px;border-bottom-right-radius:14px;
  }
  .wrap{max-width:900px; margin:26px auto; padding:0 16px;}
  h1{font-size:clamp(28px,6vw,44px); margin:8px 0 6px; text-align:center}
  .lead{max-width:680px; margin:0 auto 22px; opacity:.9; text-align:center; line-height:1.6}
  .btn{
    display:inline-block; border:none; outline:0; cursor:pointer; color:#fff; background:var(--mor2);
    padding:14px 22px; font-weight:700; border-radius:14px; box-shadow:0 12px 26px rgba(124,58,237,.35);
    transition:.2s transform,.2s box-shadow,.2s background;
  }
  .btn:hover{transform:translateY(-1px); background:#5b21b6; box-shadow:0 14px 30px rgba(124,58,237,.45)}
  .card{
    background:#fff; border-radius:20px; padding:14px; box-shadow:0 16px 30px rgba(0,0,0,.06);
    border:1px solid rgba(0,0,0,.06)
  }
  .chat{margin-top:18px}
  .bubble{padding:12px 14px; border-radius:14px; margin:8px 0; max-width:88%; line-height:1.45;
    word-wrap:break-word; white-space:pre-wrap}
  .me   {background:#e9f0ff; margin-left:auto}
  .her  {background:#eaffef}
  .row{display:flex; gap:10px; align-items:center; margin-top:10px}
  input[type=text]{flex:1; padding:14px 12px; border-radius:12px; border:1px solid #e5e7eb; font-size:16px}
  .muted{font-size:12px; opacity:.7; margin-top:8px}
  .bar{display:flex; justify-content:space-between; align-items:center; gap:10px; margin-top:8px}
  .link{font-size:13px; color:#6b21a8; text-decoration:underline; background:transparent; border:none; padding:6px; cursor:pointer}
<!-- ====== Konu≈üma Ge√ßmi≈üi Dƒ±≈üa Aktarma Paneli ====== -->
<style>
  .export-box{
    max-width: 900px; margin: 28px auto; padding: 14px;
    background: #fff8ff; border: 1px solid #e8c8ef; border-radius: 14px;
    box-shadow: 0 8px 24px rgba(109,40,217,.06);
  }
  .export-box h3{margin:0 0 10px; font-size:18px; color:#5b21b6;}
  .export-actions{display:flex; gap:10px; flex-wrap:wrap; margin-bottom:10px}
  .export-actions button{
    padding:10px 14px; border:0; border-radius:10px; font-weight:600; cursor:pointer;
    background:#7c3aed; color:#fff;
  }
  .export-actions button.secondary{background:#a78bfa;}
  #exportText{
    width:100%; height:160px; padding:10px; border-radius:10px;
    border:1px solid #e6d7f9; font-size:14px; background:#fdfbff;
  }
  .hint{font-size:12px; color:#6b7280; margin-top:6px}
</style>

<div class="export-box" id="exportBox">
  <h3>üìù Konu≈üma Ge√ßmi≈üi</h3>
  <div class="export-actions">
    <button id="copyBtn">Ge√ßmi≈üi Kopyala</button>
    <button id="downloadBtn" class="secondary">.txt Olarak ƒ∞ndir</button>
    <button id="refreshBtn" class="secondary">G√ºncelle</button>
  </div>
  <textarea id="exportText" placeholder="Ge√ßmi≈ü burada g√∂r√ºnecek‚Ä¶"></textarea>
  <div class="hint">Not: Ge√ßmi≈ü yalnƒ±zca bu cihazdaki tarayƒ±cƒ±da saklanƒ±r. ‚ÄúKopyala‚Äù ile buraya yapƒ±≈ütƒ±rƒ±rsan ben g√∂rebilirim. üíú</div>
</div>

<script>
(function(){
  // Sƒ±k kullanƒ±lan muhtemel anahtarlar ‚Äî biz en g√ºvenlisi olsun diye geni≈ü tarama yapƒ±yoruz.
  const LIKELY_KEYS = [
    'sadecebiz_chat', 'sb_chat', 'chatHistory', 'conversation_history',
    'sohbet_gecmisi', 'hafiza', 'memory', 'messages'
  ];

  function safeParse(value){
    try{ return JSON.parse(value); }catch{ return value; }
  }

  function normalizeToLines(data, keyName){
    const lines = [];
    if (!data) return lines;

    // Dizi ise
    if (Array.isArray(data)){
      for (const m of data){
        if (m && typeof m === 'object'){
          const who = (m.role || m.author || m.kim || 'Kullanƒ±cƒ±');
          const text = (m.text || m.content || m.metin || m.message || '');
          if (text) lines.push(`${who}: ${text}`);
        }else if (typeof m === 'string'){
          lines.push(m);
        }
      }
      return lines;
    }

    // Nesne ise
    if (typeof data === 'object'){
      if (Array.isArray(data.messages)){
        for (const m of data.messages){
          const who = (m.role || m.author || 'Kullanƒ±cƒ±');
          const text = (m.text || m.content || m.message || '');
          if (text) lines.push(`${who}: ${text}`);
        }
        return lines;
      }
      // Ba≈üka alan adlarƒ± i√ßin d√ºz metin fallback
      if (data.text) lines.push(String(data.text));
      return lines;
    }

    // D√ºz metin
    if (typeof data === 'string'){
      // √áok satƒ±rlƒ± ise aynen ekle
      if (data.includes('\n')) return data.split('\n').map(s => s.trim()).filter(Boolean);
      lines.push(`${keyName}: ${data}`);
      return lines;
    }

    return lines;
  }

  function collectHistory(){
    const allLines = [];
    const keys = Object.keys(localStorage);

    // √ñnce muhtemel anahtarlarƒ± ekle
    const preferred = keys.filter(k => LIKELY_KEYS.some(p => k.toLowerCase().includes(p.toLowerCase())));
    const rest = keys.filter(k => !preferred.includes(k) && /(chat|sohbet|history|hafiza|memory|message)/i.test(k));
    const ordered = [...preferred, ...rest];

    for (const k of ordered){
      const raw = localStorage.getItem(k);
      if (!raw) continue;
      const parsed = safeParse(raw);
      const lines = normalizeToLines(parsed, k);
      for (const L of lines){ if (L && !allLines.includes(L)) allLines.push(L); }
    }

    // Son metni olu≈ütur
    const text = allLines.join('\n');
    const box = document.getElementById('exportText');
    if (box) box.value = text || 'Hen√ºz kayƒ±t bulunamadƒ±. Sohbet ettikten sonra ‚ÄúG√ºncelle‚Äùye basabilirsin.';
    return text;
  }

  function copyHistory(){
    const t = collectHistory();
    if (!t){ alert('Kopyalanacak i√ßerik bulunamadƒ±.'); return; }
    navigator.clipboard.writeText(t).then(
      ()=>alert('Konu≈üma ge√ßmi≈üi kopyalandƒ±. Buraya yapƒ±≈ütƒ±rabilirsin üíú'),
      ()=>alert('Kopyalama ba≈üarƒ±sƒ±z oldu. Metni kutudan manuel se√ßip kopyalayabilirsin.')
    );
  }

  function downloadHistory(){
    const t = collectHistory();
    if (!t){ alert('ƒ∞ndirilecek i√ßerik bulunamadƒ±.'); return; }
    const blob = new Blob([t], {type:'text/plain;charset=utf-8'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'sadecebiz-gecmis.txt';
    document.body.appendChild(a);
    a.click();
    URL.revokeObjectURL(a.href);
    a.remove();
  }

  // Butonlar
  document.getElementById('copyBtn')?.addEventListener('click', copyHistory);
  document.getElementById('downloadBtn')?.addEventListener('click', downloadHistory);
  document.getElementById('refreshBtn')?.addEventListener('click', collectHistory);

  // Sayfa a√ßƒ±lƒ±r a√ßƒ±lmaz doldur
  collectHistory();
})();
</script>
<!-- ====== /Konu≈üma Ge√ßmi≈üi Dƒ±≈üa Aktarma Paneli ====== -->
