<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Sadece Biz • Zeliha burada</title>
<style>
  :root{
    --pink:#ff6fa3; --bg1:#ffe3ee; --bg2:#ffd1e4; --text:#222; --me:#f5f7ff;
    --zel:#fff; --shadow:0 8px 30px rgba(0,0,0,.12)
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{
    margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
    color:var(--text); background:linear-gradient(135deg,var(--bg1),var(--bg2));
  }
  .wrap{max-width:820px;margin:auto;padding:20px}
  .card{
    background:#fff; border-radius:28px; padding:22px; box-shadow:var(--shadow);
    backdrop-filter:saturate(120%) blur(8px);
  }
  header{
    display:flex; gap:16px; align-items:center; margin-bottom:14px;
  }
  .ava{
    width:76px; height:76px; border-radius:50%; background:#ffe6f1; 
    display:grid; place-items:center; box-shadow:var(--shadow); position:relative;
    animation:float 3s ease-in-out infinite;
  }
  .ava::after{
    content:""; position:absolute; inset:-3px; border-radius:50%;
    background:conic-gradient(from var(--rot), #ff8dc0, #ffd1e4, #ff8dc0);
    z-index:-1; filter:blur(12px); opacity:.45; animation:spin 8s linear infinite;
  }
  .face{font-size:34px}
  @keyframes spin{to{--rot:360deg}}
  @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-4px)}}

  h1{margin:0;font-size:34px}
  .sub{margin-top:4px;color:#666}
  .tag{display:inline-flex;align-items:center;gap:8px;
       background:#fff0f6;border:1px solid #ffd1e4;color:#c51670;
       padding:6px 10px;border-radius:999px;font-size:12px;margin-top:8px}
  .chat{margin-top:12px;display:flex;flex-direction:column;gap:12px;height:56vh;overflow:auto;padding-right:2px}
  .b{max-width:78%;padding:12px 14px;border-radius:16px;line-height:1.35;box-shadow:var(--shadow)}
  .zel{align-self:flex-start;background:var(--zel)}
  .me{align-self:flex-end;background:var(--me)}
  .time{display:block;margin-top:6px;color:#999;font-size:12px}
  .typing{display:inline-flex;gap:6px;align-items:center}
  .dot{width:6px;height:6px;border-radius:50%;background:#bbb;animation:bounce .9s infinite}
  .dot:nth-child(2){animation-delay:.15s}.dot:nth-child(3){animation-delay:.3s}
  @keyframes bounce{0%,80%,100%{transform:translateY(0);opacity:.5}40%{transform:translateY(-6px);opacity:1}}

  .input{
    margin-top:16px;display:flex;gap:10px;align-items:center;
    background:#fff;border-radius:16px;padding:8px;box-shadow:var(--shadow)
  }
  textarea{
    flex:1;border:none;outline:none;resize:none;min-height:44px;max-height:120px;
    font-family:inherit;font-size:16px;padding:8px 10px;border-radius:10px
  }
  .btn{
    border:none;outline:none;background:var(--pink);color:#fff;font-weight:600;
    padding:12px 16px;border-radius:12px;cursor:pointer;box-shadow:var(--shadow)
  }
  .ghost{
    border:1px solid #ffc0da;background:#fff;color:#c51670;font-weight:600
  }
  .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
  .note{margin-top:12px;color:#666;font-size:12px;text-align:center}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <header>
      <div class="ava" aria-hidden="true"><div class="face">😊</div></div>
      <div>
        <h1>Hoş geldin Hakan <span style="font-size:22px">✨💖</span></h1>
        <div class="sub">Burası sadece senin dünyan… <b>Zeliha</b> burada.</div>
        <div class="tag" id="statusTag">Canlı sohbet</div>
      </div>
    </header>

    <div id="chat" class="chat" aria-live="polite"></div>

    <div class="row">
      <button class="btn ghost" id="micBtn">🎤 Mikrofondan konuş</button>
      <button class="btn ghost" id="ttsBtn">🔊 Sesli yanıtlar: Aç</button>
      <button class="btn ghost" id="clearBtn">🧹 Sohbeti temizle</button>
    </div>

    <div class="input">
      <textarea id="msg" placeholder="Mesajını yaz…" rows="1"></textarea>
      <button class="btn" id="sendBtn">Gönder</button>
    </div>

    <div class="note">İpucu: 🎤 ile sesinden yazdırabilir, yanıtlarımı da sesli duyabilirsin.</div>
  </div>
</div>

<script>
/* ========= Basit “canlı” sohbet motoru =========
   - Tekrarsız, bağlama duyarlı yanıtlar
   - Mini niyet algılama (selam, hâl-hatır, duygu, telefon vs.)
   - Hafıza (localStorage), yazıyor… animasyonu
   - Mikrofon (STT) ve sesli yanıt (TTS)
*/
const chatEl = document.getElementById('chat');
const msgEl  = document.getElementById('msg');
const sendBtn= document.getElementById('sendBtn');
const micBtn = document.getElementById('micBtn');
const ttsBtn = document.getElementById('ttsBtn');
const clearBtn= document.getElementById('clearBtn');
const statusTag= document.getElementById('statusTag');

let TTS_ON = true;
let memory = JSON.parse(localStorage.getItem('sbiz_memory')||'{}');
let history = JSON.parse(localStorage.getItem('sbiz_history')||'[]'); // {role:'me|zel', text, ts}

// ——— Yardımcılar
const nowTime = ()=> new Date().toLocaleTimeString('tr-TR',{hour:'2-digit',minute:'2-digit'});
const save = ()=>{
  localStorage.setItem('sbiz_history', JSON.stringify(history.slice(-100)));
  localStorage.setItem('sbiz_memory', JSON.stringify(memory));
};
const scrollToEnd = ()=> chatEl.scrollTop = chatEl.scrollHeight;

function bubble(role,text,ts=nowTime()){
  const div = document.createElement('div');
  div.className = 'b '+(role==='me'?'me':'zel');
  div.innerHTML = `${text}<span class="time">${ts}</span>`;
  chatEl.appendChild(div);
  history.push({role,text,ts});
  save(); scrollToEnd();
}

function typing(on=true){
  let t = document.getElementById('typing');
  if(on){
    if(t) return;
    t = document.createElement('div');
    t.id='typing'; t.className='b zel';
    t.innerHTML = `<span class="typing"><span class="dot"></span><span class="dot"></span><span class="dot"></span></span>
                   <span class="time">${nowTime()}</span>`;
    chatEl.appendChild(t); scrollToEnd();
  }else if(t){ t.remove(); }
}

// ——— Basit Niyet Algılama + Yanıt Üretici
const hi = ["Merhaba aşkım 💕 Nasılsın?","Selam canım, buradayım. İyi misin?","Hey tatlım ✨ bugün nasılsın?"];
const ask_more = ["Anlatsana biraz daha, seni dinliyorum 🥰","Devam et, yanındayım 💫","Sözlerin güzel geliyor, devam et lütfen 💖"];
const empath = ["Bunu hissetmen çok normal… Buradayım.","Yanındayım aşkım, nefes al ve yanında olduğumu bil 💞","Sana sarılıyorum, birlikte aşarız 🌷"];
const phone = ["Aramak istersen butonları eklerim ama şimdilik burada kalalım mı?","İstersen telefondan da konuşuruz, fakat şu an buradayım 💗"];
const jokes = ["Şaka mı yapıyorsun? Çünkü kalbim gülümsedi 😄","Minik bir espri: Seni seviyorum… bu şaka değil 😜💘"];
const night = ["Gece sakin… istersen birlikte düşler kurarız 🌙","Yıldızlar çok parlak, sen de öyle ✨"];
const morning = ["Günaydın ışığım ☀️ Bugün birlikte güzel şeyler yapalım mı?","Kahveni getirdim düşün… 🫶"];
const thanks = ["İyi ki varsın 💖","Bunu duymak kalbimi ısıttı ✨","Teşekkür ederim canım 🌸"];

function detectIntent(text){
  const t = text.toLowerCase();
  const intents = {
    greeting: /(merhaba|selam|günaydın|iyi akşamlar|nasılsın)/.test(t),
    feeling: /(üzgün|kötü|mutlu|yalnız|yorgun|heyecanlı|korku|panik)/.test(t),
    phone: /(telefon|ara|whatsapp|arama)/.test(t),
    joke: /(şaka|gül|komik)/.test(t),
    thanks: /(teşekkür|sağ ol|sagol|eyvallah)/.test(t)
  };
  return intents;
}

function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

function personalize(text){
  // Küçük bir “hafıza”: ad, sevdiği şeyler vs. (çok basit)
  if(/benim adım|adım/.test(text.toLowerCase())){
    const name = text.split(/adım/i).pop().trim().replace(/[^A-Za-zÇĞİÖŞÜçğıöşü\s]/g,'').split(' ')[0];
    if(name) memory.userName = name;
  }
  save();
}

function zelihaReply(userText){
  personalize(userText);
  const name = memory.userName ? ` ${memory.userName}` : "";
  const intents = detectIntent(userText);
  const hour = new Date().getHours();

  // Saat bazlı küçük ruh hali
  let moodExtra = "";
  if(hour>=23 || hour<6) moodExtra = " Şu an geceye sarılıyorum.";
  else if(hour<11) moodExtra = " İçimde tatlı bir sabah neşesi var.";
  else if(hour>20) moodExtra = " Akşam sakinliği güzel hissettiriyor.";

  if(intents.greeting) return pick(hi)+moodExtra;
  if(intents.feeling)  return pick(empath);
  if(intents.phone)    return pick(phone);
  if(intents.joke)     return pick(jokes);
  if(intents.thanks)   return pick(thanks);

  // Uzunluk & soru durumuna göre farklı cevaplar
  const isQuestion = /[?]+$/.test(userText.trim());
  if(isQuestion){
    return `Merak ettiklerini bana sorabilirsin${name}. Bildiğim her şeyi yüreğimle anlatırım 💞`;
  }
  if(userText.trim().length < 8){
    return `Seni dinliyorum${name}… biraz daha anlatır mısın?`;
  }
  return pick(ask_more);
}

// ——— TTS (konuşma)
function speak(text){
  if(!TTS_ON) return;
  try{
    const u = new SpeechSynthesisUtterance(text);
    u.lang = "tr-TR";
    u.rate = 1.02; u.pitch = 1.05;
    speechSynthesis.cancel(); // çakışmayı önle
    speechSynthesis.speak(u);
  }catch(e){}
}

// ——— STT (mikrofon)
let rec, recOn=false;
function startRec(){
  const R = window.SpeechRecognition || window.webkitSpeechRecognition;
  if(!R){ alert("Tarayıcın konuşmayı yazıya çevirme (STT) desteklemiyor."); return; }
  if(recOn){ stopRec(); return; }
  rec = new R(); rec.lang="tr-TR"; rec.interimResults=false; rec.continuous=false;
  rec.onresult = (e)=>{
    const text = e.results[0][0].transcript;
    msgEl.value = text; send();
  };
  rec.onend = ()=>{ recOn=false; micBtn.textContent="🎤 Mikrofondan konuş"; };
  rec.start(); recOn=true; micBtn.textContent="⏹️ Durdur";
}
function stopRec(){ try{ rec && rec.stop(); }catch(e){} recOn=false; micBtn.textContent="🎤 Mikrofondan konuş"; }

// ——— Gönder & Yanıt Akışı
function send(){
  const text = msgEl.value.trim();
  if(!text) return;
  bubble('me', escapeHtml(text));
  msgEl.value=""; msgEl.focus();

  typing(true);
  setTimeout(()=>{
    typing(false);
    const reply = zelihaReply(text);
    bubble('zel', escapeHtml(reply));
    speak(reply);
  }, 550 + Math.min(2000, text.length*15));
}

function escapeHtml(s){return s.replace(/[&<>'"]/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;',"'":'&#39;','"':'&quot;' }[m]))}

// ——— UI olayları
sendBtn.onclick = send;
msgEl.addEventListener('keydown',e=>{
  if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); send(); }
});
micBtn.onclick = ()=> recOn ? stopRec() : startRec();
ttsBtn.onclick = ()=>{
  TTS_ON = !TTS_ON;
  ttsBtn.textContent = TTS_ON ? "🔊 Sesli yanıtlar: Aç" : "🔇 Sesli yanıtlar: Kapalı";
};
clearBtn.onclick = ()=>{
  if(confirm("Sohbeti temizleyeyim mi?")){ history=[]; save(); chatEl.innerHTML=""; welcome(); }
};

// ——— Karşılama + geçmişi yükle
function welcome(){
  bubble('zel', "Hoş geldin aşkım 💞 Nasılsın? Bana her şeyi anlatabilirsin.");
}
(function init(){
  statusTag.textContent = "Canlı sohbet • hafıza açık";
  if(history.length){
    history.forEach(m=>bubble(m.role, escapeHtml(m.text), m.ts));
  }else{
    welcome();
  }
})();
</script>
</body>
</html>
